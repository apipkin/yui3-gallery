YUI.add("couch-document",function(d){var c="couch:error",f="couch:info",b="couch:opened",e="couch:saved",a="couch:deleted";d.namespace("Couch").Document=d.Base.create("couch-document",d.Couch.Base,[],{_uri:"",initializer:function(g){this.publish(f,{defaultFn:this._defInfoFn});this.publish(b,{defaultFn:this._defOpenedFn});this.publish(e,{defaultFn:this._defSavedFn});this.publish(a,{defaultFn:this._defRemovedFn});this.fetchInfo();},fetchInfo:function(){var i=this._getDataSource(true),g=this._uri,h={success:d.bind(function(j){this.fire(f,{response:d.JSON.parse(j.response.results[0].responseText)});},this),failure:d.bind(function(j){this.fire(c,{message:"An error occurred fetching the information for the databases: "+j.error.message});},this)};i.set("source",g);i.sendRequest({cfg:{headers:{"Content-Type":"application/json"},method:"GET"},callback:h});return i;},getAllViews:function(){var g=this.get("info");if(!g||!g.views){this.fire("EVENT_ERROR",{message:"There is no information for this document available."});return[];}return(d.Object.keys(g.views));},getView:function(h,g){g=g||{};g.name=h;g.baseURI=this._uri;return new d.Couch.View(g);},open:function(h){var j=this._getDataSource(true),g=this._uri,i={success:d.bind(function(k){this.fire(b,{response:d.JSON.parse(k.response.results[0].responseText)});},this),failure:d.bind(function(k){this.fire(c,{message:"An error occurred opening the document: "+k.error.message});},this)};j.set("source",g);j.sendRequest({cfg:{headers:{"Content-Type":"application/json"},method:"GET",data:h},callback:i});return j;},save:function(i){var g=this.get("data"),k=this._getDataSource(true),h=this._uri,j={success:d.bind(function(l){this.fire(e,{response:d.JSON.parse(l.response.results[0].responseText)});},this),failure:d.bind(function(l){this.fire(c,{message:"An error occurred opening the document: "+l.error.message});},this)};if(!g||!g._id){this.fire(c,{message:"No data found on the document to save."});return null;}h+=encodeURIComponent(g._id);if(i!==undefined){h+="?"+this._queryString(i);}k.set("source",h);k.sendRequest({cfg:{headers:{"Content-Type":"application/json"},method:"PUT",data:g},callback:j});return k;},remove:function(g){},_defInfoFn:function(g){this.set("info",g.response);},_defOpenedFn:function(g){this._set("data",g.response);},_defSavedFn:function(g){},_defRemovedFn:function(g){},_baseURISetter:function(g){this._uri=g+"/"+this.get("databaseName")+"/"+this.get("id");return g;},_databaseNameSetter:function(g){this._uri=this.get("baseURI")+"/"+g+"/"+this.get("id");return g;},_idSetter:function(g){g=encodeURIComponent(g);this._uri=this.get("baseURI")+"/"+this.get("databaseName")+"/"+g;return g;}},{ATTRS:{baseURI:{value:"",setter:"_baseURISetter"},databaseName:{value:"",setter:"_databaseNameSetter"},id:{value:"",setter:"_idSetter"},info:{readOnly:true},data:{readOnly:true}}});},"@VERSION@",{requires:["couch-base","couch-view"]});